# =============================================================================
# Savannah Backend API - Environment Configuration
# =============================================================================
# Copy this file to .env and customize the values for your environment
# DO NOT commit .env files to version control

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================

# Environment: development, staging, production
ENVIRONMENT=development

# Server configuration
PORT=8080
HOST=0.0.0.0

# Application version (used in health checks and monitoring)
APP_VERSION=1.0.0
BUILD_DATE=2024-01-01T00:00:00Z

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL connection string
# Format: postgres://username:password@hostname:port/database?sslmode=disable
DATABASE_URL=postgres://devuser:devpass@localhost:5432/savannah_db?sslmode=disable

# Alternative individual database settings (if not using DATABASE_URL)
DB_HOST=localhost
DB_PORT=5432
DB_USER=devuser
DB_PASSWORD=devpass
DB_NAME=savannah_db
DB_SSLMODE=disable

# Connection pool settings
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
DB_CONN_MAX_LIFETIME=300s

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis connection string
# Format: redis://password@hostname:port/database
REDIS_URL=redis://localhost:6379/0

# Alternative individual Redis settings (if not using REDIS_URL)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Redis connection pool settings
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=5
REDIS_DIAL_TIMEOUT=5s
REDIS_READ_TIMEOUT=3s
REDIS_WRITE_TIMEOUT=3s

# =============================================================================
# AUTHENTICATION & AUTHORIZATION (OIDC)
# =============================================================================

# OpenID Connect provider configuration
OIDC_ISSUER_URL=https://your-oidc-provider.com
OIDC_CLIENT_ID=your-client-id
OIDC_CLIENT_SECRET=your-client-secret

# JWT configuration
JWT_SIGNING_METHOD=RS256
JWT_AUDIENCE=savannah-backend-api
JWT_ISSUER=https://your-oidc-provider.com

# Token validation settings
JWT_LEEWAY=10s
JWT_REQUIRED_CLAIMS=aud,exp,iat,iss,sub
JWT_REQUIRED_SCOPES=read:customers,write:customers,read:orders,write:orders

# =============================================================================
# SMS SERVICE CONFIGURATION (Africa's Talking)
# =============================================================================

# Africa's Talking credentials
AFRICASTALKING_USERNAME=your-username
AFRICASTALKING_API_KEY=your-api-key

# SMS service settings
SMS_SENDER_ID=SAVANNAH
SMS_ENVIRONMENT=sandbox  # sandbox or production

# SMS queue settings
SMS_QUEUE_NAME=sms_notifications
SMS_WORKER_CONCURRENCY=5
SMS_MAX_RETRIES=3
SMS_RETRY_BACKOFF=exponential
SMS_RETRY_INITIAL_INTERVAL=30s
SMS_RETRY_MAX_INTERVAL=300s

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Log format: json, text
LOG_FORMAT=json

# Log output: stdout, stderr, file
LOG_OUTPUT=stdout

# Log file path (if LOG_OUTPUT=file)
LOG_FILE_PATH=/var/log/savannah-backend.log

# Log rotation settings (if using file logging)
LOG_MAX_SIZE=100MB
LOG_MAX_AGE=30d
LOG_MAX_BACKUPS=10

# =============================================================================
# MONITORING & METRICS
# =============================================================================

# Prometheus metrics
METRICS_ENABLED=true
METRICS_PATH=/metrics

# Health check configuration
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_TIMEOUT=30s

# Application monitoring
MONITORING_ENABLED=true
TRACING_ENABLED=false
TRACING_ENDPOINT=http://localhost:14268/api/traces

# =============================================================================
# SECURITY SETTINGS
# =============================================================================

# CORS configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Requested-With
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=86400

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# Security headers
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000
CONTENT_TYPE_NOSNIFF=true
FRAME_DENY=true
XSS_PROTECTION=true

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Feature toggles
FEATURE_SMS_NOTIFICATIONS=true
FEATURE_AUDIT_LOGGING=true
FEATURE_METRICS_COLLECTION=true
FEATURE_RATE_LIMITING=true

# A/B Testing flags
FEATURE_NEW_CUSTOMER_FLOW=false
FEATURE_ENHANCED_ORDERING=false

# =============================================================================
# EXTERNAL SERVICES
# =============================================================================

# Service timeouts
HTTP_CLIENT_TIMEOUT=30s
HTTP_CLIENT_KEEP_ALIVE=30s
HTTP_CLIENT_MAX_IDLE_CONNS=100
HTTP_CLIENT_IDLE_CONN_TIMEOUT=90s

# Retry configuration for external services
EXTERNAL_SERVICE_MAX_RETRIES=3
EXTERNAL_SERVICE_RETRY_DELAY=1s
EXTERNAL_SERVICE_RETRY_MAX_DELAY=30s

# =============================================================================
# DEVELOPMENT & TESTING
# =============================================================================

# Development mode settings
DEV_MODE=true
DEV_AUTO_MIGRATE=true
DEV_SEED_DATA=true
DEV_CORS_ALLOW_ALL=true

# Testing configuration
TEST_DATABASE_URL=postgres://testuser:testpass@localhost:5432/test_db?sslmode=disable
TEST_REDIS_URL=redis://localhost:6379/1

# Debug settings
DEBUG_ENABLED=true
DEBUG_SQL_QUERIES=false
DEBUG_HTTP_REQUESTS=false
DEBUG_REDIS_COMMANDS=false

# =============================================================================
# DEPLOYMENT & INFRASTRUCTURE
# =============================================================================

# Kubernetes deployment
K8S_NAMESPACE=default
K8S_SERVICE_NAME=savannah-backend
K8S_POD_NAME=${HOSTNAME}

# Resource limits (for containerized deployments)
MEMORY_LIMIT=512Mi
CPU_LIMIT=500m
MEMORY_REQUEST=256Mi
CPU_REQUEST=250m

# Graceful shutdown
SHUTDOWN_TIMEOUT=30s
SHUTDOWN_DELAY=5s

# =============================================================================
# ADDITIONAL CONFIGURATION
# =============================================================================

# Custom business logic settings
BUSINESS_RULES_ENGINE_ENABLED=false
NOTIFICATION_TEMPLATES_PATH=./templates
STATIC_FILES_PATH=./static

# Integration settings
WEBHOOK_SECRET=your-webhook-secret
API_KEY_HEADER=X-API-Key
REQUEST_ID_HEADER=X-Request-ID

# Backup and archival settings
DATA_RETENTION_DAYS=2555  # 7 years
AUDIT_LOG_RETENTION_DAYS=2555
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM

# =============================================================================
# ENVIRONMENT-SPECIFIC OVERRIDES
# =============================================================================

# Production-specific settings (uncomment for production)
# ENVIRONMENT=production
# LOG_LEVEL=warn
# DEBUG_ENABLED=false
# DEV_MODE=false
# CORS_ALLOW_CREDENTIALS=false
# RATE_LIMIT_REQUESTS_PER_MINUTE=100

# Staging-specific settings (uncomment for staging)
# ENVIRONMENT=staging
# LOG_LEVEL=info
# FEATURE_NEW_CUSTOMER_FLOW=true
# FEATURE_ENHANCED_ORDERING=true